#!@pathperl@
$prefix = "@prefix@";
$datadir = "@datadir@";
$debugger = "avr-gdb";

@argcmds = ( "-b", "--cd", "--command", "--core", "--pid", "--directory",
	     "--exec", "--interpreter", "--se", "--symbols", "--tty",
	     "-s", "-e", "-se", "-x", "-d" );

for ($i = 0; $i <= $#ARGV; $i++) {
    $arg = $ARGV[$i];

    if (grep $_ eq $arg, @argcmds) {
	$i++;
    }
    elsif ($arg eq "--debugger" && $i < $#ARGV) {
	$debugger = $ARGV[$i + 1];
	splice @ARGV, $i, 2;
	$i--;
    }
    elsif ($arg eq "--capture") {
	$ENV{AVARICE_ARGS} = "$ENV{AVARICE_ARGS} --capture";
	splice @ARGV, $i, 1;
	# Don't load an executable
	$capture = 1;
	$i--;
    }
    elsif (!($arg =~ /^-/)) {
	$exe = $arg;
	break;
    }
}

$exe = "" if $capture;

system "start-avarice $exe";
unshift @ARGV, ($debugger, "-x", "$datadir/avarice/gdb-avarice-script" );
exec @ARGV;
